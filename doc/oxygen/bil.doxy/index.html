<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Bil: P99 - Preprocessor macros and functions for C99 and C11</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Bil
   &#160;<span id="projectnumber">2.11</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('index.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">P99 - Preprocessor macros and functions for C99 and C11 </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>P99 is a suite of macro and function definitions that ease programming in modern C, aka C99. By using new facilities in C99 we implement default arguments for functions, scope bound resource management, transparent allocation and initialization, ...</p>
<p>By using special features of some compilers and operating systems, we also are able to provide an almost feature complete emulation of the new C standard, C11.</p>
<h1><a class="anchor" id="introduction"></a>
Macros and inline functions working together</h1>
<p>In C, functions (whether <code>inline</code> or not) and macros fulfill different purposes. Their difference should not be seen as ideological as some seem to take it, and what is even more important, they may work nicely together.</p>
<p>Macros are text replacement that is done at compile time and they can do things like <a class="el" href="group__integers.html#ga3eb39ccac28ebd8265c1a31dc00f53ab" title="Determine if EXPR has an unsigned or signed integral type.">P99_SIGNED(EXPR)</a> which is defined by P99. That macro takes an expression as an argument, and tells at compile time of whether or not the integral type of <code>EXPR</code> is signed or not. Additionally it guarantees that <code>EXPR</code> itself is not evaluated at run time (so there are no side effects), but that only its type is taken into consideration.</p>
<p>Such an example shows that macros are ideally used when the type of an expression is to be determined and you want to act accordingly to that type. On the other hand, the pitfall with macros is that their arguments may be evaluated several times, which is bad because of side effects.</p>
<p>Functions on the other hand are typed, which makes them more strict or, phrased negatively, less flexible. Consider the function</p>
<div class="fragment"><div class="line"><span class="keyword">inline</span></div>
<div class="line">uintmax_t <a class="code" href="group__integers.html#ga0e7640b188fed337c7e97481fe0d1b0a">p00_abs_signed</a>(intmax_t <a class="code" href="test-p99-c11_8c.html#aa4c2a5552e9bc49b1816ff532f558c74">a</a>) {</div>
<div class="line"> <span class="keywordflow">return</span> (<a class="code" href="test-p99-c11_8c.html#aa4c2a5552e9bc49b1816ff532f558c74">a</a> &lt; 0) ? -(uintmax_t)<a class="code" href="test-p99-c11_8c.html#aa4c2a5552e9bc49b1816ff532f558c74">a</a> : (uintmax_t)<a class="code" href="test-p99-c11_8c.html#aa4c2a5552e9bc49b1816ff532f558c74">a</a>;</div>
<div class="line">}</div>
</div><!-- fragment --><p>It takes signed integer value <code>a</code> and computes its absolute value. Observe that the return type of this function is unsigned. This has to be so, since otherwise not all valid values could be realized.</p>
<p><code>p00_abs_signed</code> would not be a good candidate for a macro, since <code>a</code> is evaluated twice in the expression; once in the controlling expression and once for returning its value or its negation.</p>
<p>We may use this function with any integral type, but then the result would probably not be what a naive programmer would expect if the argument is a large unsigned value. The argument will be promoted to <code>intmax_t</code>. If the value <code>X</code> that is passed to the call is positive and greater than <code> INTMAX_MAX = 2<sup>N</sup> -1</code>, the result is probably not what we'd expect.@fntm 1@efntm If the conversion to <code>intmax_t</code> doesn't result in a range error thrown by the run time system (it would be permitted to do so), the argument <em>a</em> of the function would receive the negative value <code>-C</code> where <code>C</code> is <code>2<sup>N</sup></code> - X. The result of the function call would then be <code>C</code> and not <code>X</code>.</p>
<p>With the following macro we get rid of these restrictions by combining the macro and the function:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#define P99_ABS(EXPR) (P99_SIGNED(EXPR) ? p00_abs_signed(EXPR) : (EXPR))</span></div>
</div><!-- fragment --><p>This has the following properties</p>
<ul>
<li>
For any integral type it returns the correct result. @fntm 2 @efntm  </li>
<li>
The argument <code>EXPR</code> is evaluated exactly once. </li>
<li>
Any recent and decent compiler will create <a class="el" href="c99.html#inline">optimal code</a> for that combined macro.  </li>
</ul>
<p>In that spirit, P99 aims to provide utilities that often combine macros and <code>inline</code> funcions and that are only possible with the <a class="el" href="c99.html">features</a> that come with C99 (read ANSI C as normalized in 1999) and that were absent in C89. The features include among others</p><ul>
<li><a class="el" href="c99.html#variadic">Variadic macros</a></li>
<li><a class="el" href="c99.html#inline">Inline functions</a></li>
<li><a class="el" href="c99.html#initializers">Designated initializers</a></li>
<li><a class="el" href="c99.html#compound">Compound literals</a></li>
<li><a class="el" href="c99.html#hide">Macros that hide a function</a></li>
<li><a class="el" href="c99.html#pragma">Pragmas inside macros</a></li>
</ul>
<p>On some platforms, P99 is also able to emulate the main features that come with <a class="el" href="">the newest C standard, C11:</a></p><ul>
<li><a class="el" href="group__generic.html">Generic</a></li>
<li><a class="el" href="group__atomic.html">C11 atomic operations</a></li>
<li><a class="el" href="group__threads.html">C11 thread emulation on top of POSIX threads</a></li>
</ul>
<p>With all these features it implements <a class="el" href="utilities.html">utilities</a> that previously had not been possible to program in C (or C macros) or that were very difficult to implement</p><ul>
<li><a class="el" href="utilities.html#defaults">Default arguments to functions</a></li>
<li><a class="el" href="utilities.html#blocks">Scope-bound resource management with for-statements</a></li>
<li><a class="el" href="utilities.html#condi">Preprocessor conditionals and loops</a></li>
<li><a class="el" href="utilities.html#alloc">Allocation and initialization facilities</a></li>
</ul>
<p>P99 also provides numerous facilities for <a class="el" href="programming.html">macro programming.</a></p>
<p>P99 is not a C library in the classical sense but merely a collection of include files:</p><ul>
<li>There is no binary library to be linked to your executable. The few functions that are provided are small wrappers that are compiled directly into your code.</li>
<li>There is nothing to configure, P99 include files should work out of the box with any conforming C99 compiler.</li>
</ul>
<p>@fnt 1 @efnt Here <code>N+1</code> is the width of <code>uintmax_t</code>, assuming most common representations of signed integers. @fnt 2 @efnt Well, there is exactly one exception to that: on systems where <code>-INTMAX_MIN</code> is not representable in <code>uintmax_t</code>, this same value may cause problems.</p>
<h1><a class="anchor" id="credits"></a>
Credits and Rights</h1>
<h2><a class="anchor" id="author"></a>
Author and Maintainer</h2>
<dl class="section author"><dt>Author</dt><dd><a href="http://www.loria.fr/~gustedt/">Jens Gustedt</a> </dd></dl>
<dl class="section date"><dt>Date</dt><dd>2010 - 2012</dd></dl>
<h2><a class="anchor" id="contributor"></a>
Contribution</h2>
<dl class="section author"><dt>Author</dt><dd><a href="http://basyl.co.uk/">William Morris</a> proof reading </dd></dl>
<dl class="section date"><dt>Date</dt><dd>2012</dd></dl>
<h2><a class="anchor" id="version"></a>
Version</h2>
<p>The version this documentation describes can be identified via the macros <a class="el" href="p99__generated_8h.html#ac0b7c01f9f3bc21880b41e49f29ef261" title="The version of the P99 collection indicated by the commit date.">P99_VERSION_DATE</a>, namely Thu Jun 29 15:37:49 2017 +0200. It also is tagged with an hexadecimal ID tag that is given in <a class="el" href="p99__generated_8h.html#adb0dca35329031f87d0052a6ee520982" title="The version of the P99 collection indicated by a unique commit ID.">P99_VERSION_ID</a>, namely 132b203160e20fe6676b3e466c52c45ffd2c31f0.</p>
<h2><a class="anchor" id="copyright"></a>
Copyright</h2>
<p>Copyright &copy; 2010-2012 Jens Gustedt, INRIA, France, <a href="http://www.inria.fr/">http://www.inria.fr/</a></p>
<h2><a class="anchor" id="license"></a>
License</h2>
<pre>
**<pre class="fragment"></pre>
   </pre> </div></div><!-- PageDoc -->
</div><!-- contents -->
</div><!-- doc-content -->
<div class="ttc" id="atest-p99-c11_8c_html_aa4c2a5552e9bc49b1816ff532f558c74"><div class="ttname"><a href="test-p99-c11_8c.html#aa4c2a5552e9bc49b1816ff532f558c74">a</a></div><div class="ttdeci">int a</div><div class="ttdef"><b>Definition:</b> test-p99-c11.c:21</div></div>
<div class="ttc" id="agroup__integers_html_ga0e7640b188fed337c7e97481fe0d1b0a"><div class="ttname"><a href="group__integers.html#ga0e7640b188fed337c7e97481fe0d1b0a">p00_abs_signed</a></div><div class="ttdeci">P99_CONST_FUNCTION p99_inline uintmax_t p00_abs_signed(intmax_t p00_a)</div><div class="ttdef"><b>Definition:</b> p99_int.h:619</div></div>
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Mon Oct 27 2025 02:40:45 for Bil by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.17 </li>
  </ul>
</div>
</body>
</html>
